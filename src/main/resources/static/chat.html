<!--
  Copyright (c) 2024 Cesar Schutz and Swagger Agent contributors
  This software is licensed under the MIT License.
  See LICENSE file for the full license text.
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swagger Agent - Assistente Inteligente</title>
    <meta name="description" content="Assistente de chat profissional especializado em APIs">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Tema Claro */
            --bg-primary: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8fafc;
            --bg-chat: #ffffff;
            --bg-sidebar: rgba(255, 255, 255, 0.98);
            --bg-message-user: linear-gradient(135deg, #2563EB 0%, #3B82F6 100%);
            --bg-message-bot: #f3f6fa;
            --bg-input: #f1f5f9;
            --bg-button: linear-gradient(135deg, #2563EB 0%, #3B82F6 100%);
            --bg-button-hover: linear-gradient(135deg, #1d4ed8 0%, #2563EB 100%);
            --bg-tool-item: #f8fafc;
            --bg-tool-hover: #e0e7ef;
            --bg-header: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --text-white: #ffffff;
            --text-user: #ffffff;
            --text-bot: #1e293b;
            
            --border-color: #e2e8f0;
            --border-hover: #cbd5e1;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.07);
            --shadow-md: 0 4px 12px -1px rgb(0 0 0 / 0.10), 0 2px 4px -2px rgb(0 0 0 / 0.08);
            --shadow-lg: 0 10px 24px -3px rgb(0 0 0 / 0.12), 0 4px 6px -4px rgb(0 0 0 / 0.10);
            --shadow-xl: 0 20px 32px -5px rgb(0 0 0 / 0.13), 0 8px 10px -6px rgb(0 0 0 / 0.11);
            
            --accent-blue: #2563eb;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            
            --transition: all 0.18s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.28s cubic-bezier(0.4, 0, 0.2, 1);
            /* Method Colors */
            --method-get-bg: #e0f2fe;
            --method-get-text: #0ea5e9;
            --method-post-bg: #dcfce7;
            --method-post-text: #22c55e;
            --method-put-bg: #ffedd5;
            --method-put-text: #f97316;
            --method-delete-bg: #fee2e2;
            --method-delete-text: #ef4444;
            --method-patch-bg: #f3e8ff;
            --method-patch-text: #a855f7;
            --method-head-bg: #e0e7ff;
            --method-head-text: #6366f1;
            --method-options-bg: #f0fdfa;
            --method-options-text: #14b8a6;
        }

        [data-theme="dark"] {
            /* Tema Escuro */
            --bg-primary: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-chat: #1e293b;
            --bg-sidebar: rgba(30, 41, 59, 0.98);
            --bg-message-user: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            --bg-message-bot: #334155;
            --bg-input: #232b3b;
            --bg-button: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            --bg-button-hover: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --bg-tool-item: #232b3b;
            --bg-tool-hover: #2d3748;
            --bg-header: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --text-white: #ffffff;
            --text-user: #ffffff;
            --text-bot: #f1f5f9;
            
            --border-color: #475569;
            --border-hover: #64748b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.18);
            --shadow-md: 0 4px 12px -1px rgb(0 0 0 / 0.18), 0 2px 4px -2px rgb(0 0 0 / 0.15);
            --shadow-lg: 0 10px 24px -3px rgb(0 0 0 / 0.22), 0 4px 6px -4px rgb(0 0 0 / 0.18);
            --shadow-xl: 0 20px 32px -5px rgb(0 0 0 / 0.23), 0 8px 10px -6px rgb(0 0 0 / 0.19);
            /* Method Colors */
            --method-get-bg: #0c4a6e;
            --method-get-text: #7dd3fc;
            --method-post-bg: #166534;
            --method-post-text: #86efac;
            --method-put-bg: #7c2d12;
            --method-put-text: #fdba74;
            --method-delete-bg: #991b1b;
            --method-delete-text: #fca5a5;
            --method-patch-bg: #5b21b6;
            --method-patch-text: #d8b4fe;
            --method-head-bg: #3730a3;
            --method-head-text: #a5b4fc;
            --method-options-bg: #115e59;
            --method-options-text: #5eead4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            min-height: 100vh;
            overflow: hidden;
            transition: var(--transition);
            font-size: 1.04rem;
        }

        .app-container {
            display: flex;
            height: 100vh;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 360px;
            background: var(--bg-sidebar);
            backdrop-filter: blur(20px);
            border-right: 1.5px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            z-index: 100;
            flex-shrink: 0;
            box-shadow: var(--shadow-md);
        }

        .sidebar.collapsed {
            width: 72px;
        }

        .sidebar-header {
            padding: 0rem 1.25rem 0rem 1rem;
            border-bottom: 1.5px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 72px;
        }

        .logo-container {
            width: 150px;
            height: 250px;
            flex-shrink: 0;
        }

        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-text {
            display: none;
        }

        .logo-title {
            font-size: 1.18rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.18rem;
            letter-spacing: 0.01em;
        }

        .logo-subtitle {
            font-size: 0.82rem;
            color: var(--text-secondary);
        }

        .sidebar-toggle {
            position: absolute;
            top: 1.25rem;
            right: -10px;
            width: 22px;
            height: 22px;
            background: var(--bg-secondary);
            border: 1.5px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            z-index: 101;
        }

        .sidebar-toggle:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        .sidebar-toggle:hover {
            background: var(--bg-tool-hover);
            transform: scale(1.08);
        }

        .sidebar-toggle i {
            font-size: 0.75rem;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .sidebar.collapsed .sidebar-toggle i {
            transform: rotate(180deg);
        }

        /* Tools Panel */
        .tools-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .tools-header {
            padding: 1.15rem 1.5rem 1.15rem 1.5rem;
            border-bottom: 1.5px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-tool-item);
        }

        .sidebar.collapsed .tools-header {
            padding: 1rem 0.5rem;
            justify-content: center;
        }

        .tools-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .sidebar.collapsed .tools-title span:not(.tools-icon) {
            display: none;
        }

        .tools-count {
            background: var(--accent-blue);
            color: var(--text-white);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .tools-count {
            display: none;
        }

        .tools-expand-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem 0.7rem;
            border-radius: var(--radius-md);
            transition: var(--transition);
            outline: none;
        }
        .tools-expand-btn:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }
        .tools-expand-btn:hover {
            background: var(--bg-tool-hover);
            color: var(--accent-blue);
        }

        .tools-content {
            overflow-y: auto;
            padding: 1.15rem 1.15rem 1.15rem 1.15rem;
        }

        .sidebar.collapsed .tools-content {
            padding: 0.5rem;
        }

        .project-section {
            margin-bottom: 1rem;
        }

        .project-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1.1rem;
            background: var(--bg-tool-item);
            border: 1.5px solid var(--border-color);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow-sm);
        }
        .project-header:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }
        .project-header:hover {
            background: var(--bg-tool-hover);
            border-color: var(--accent-blue);
            transform: translateY(-2px) scale(1.01);
            box-shadow: var(--shadow-md);
        }

        .project-icon {
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .project-header.collapsed .project-icon {
            transform: rotate(-90deg);
        }

        .project-name {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .sidebar.collapsed .project-name {
            display: none;
        }

        .project-count {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .sidebar.collapsed .project-count {
            display: none;
        }

        .project-tools {
            margin-left: 0.5rem;
            transition: var(--transition-slow);
            overflow: hidden;
        }

        .project-tools.collapsed {
            max-height: 0;
            margin-bottom: 0;
        }

        .sidebar.collapsed .project-tools {
            display: none;
        }

        .tool-item {
            padding: 1.15rem 1.25rem;
            background: var(--bg-tool-item);
            border: 1.5px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 0.7rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        .tool-item:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }
        .tool-item:hover {
            background: var(--bg-tool-hover);
            border-color: var(--accent-blue);
            transform: translateX(6px) scale(1.01);
            box-shadow: var(--shadow-md);
        }
        .tool-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-blue);
            transform: scaleY(0);
            transition: var(--transition);
        }
        .tool-item:hover::before {
            transform: scaleY(1);
        }
        .tool-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.35rem;
            font-size: 0.97rem;
        }
        .tool-method {
            display: inline-block;
            padding: 0.22rem 0.55rem;
            border-radius: var(--radius-sm);
            font-size: 0.78rem;
            font-weight: 600;
            margin-bottom: 0.35rem;
        }
        .method-get { background-color: var(--method-get-bg); color: var(--method-get-text); }
        .method-post { background-color: var(--method-post-bg); color: var(--method-post-text); }
        .method-put { background-color: var(--method-put-bg); color: var(--method-put-text); }
        .method-delete { background-color: var(--method-delete-bg); color: var(--method-delete-text); }
        .method-patch { background-color: var(--method-patch-bg); color: var(--method-patch-text); }
        .method-head { background-color: var(--method-head-bg); color: var(--method-head-text); }
        .method-options { background-color: var(--method-options-bg); color: var(--method-options-text); }

        .tool-path {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.74rem;
            color: var(--text-muted);
            margin-bottom: 0.35rem;
            word-break: break-all;
        }

        .tool-description {
            font-size: 0.74rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Main Chat Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-chat);
            position: relative;
        }

        .chat-header {
            padding: 1.25rem 2rem 1.25rem 2rem;
            background: var(--bg-header);
            border-bottom: 1.5px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 72px;
            position: relative;
            padding-right: 5.5rem; /* Mais espaço para o toggle */
            box-shadow: var(--shadow-md);
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-title h1 {
            font-size: 1.35rem;
            font-weight: 800;
            color: var(--text-white);
            letter-spacing: 0.01em;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.13);
            padding: 0.45rem 1rem;
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
            font-size: 0.97rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .session-info {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .session-id {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            margin-left: 0.5rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 1.25rem;
            right: 1.7rem;
            width: 42px;
            height: 42px;
            background: var(--bg-secondary);
            border: 1.5px solid var(--border-color);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            z-index: 10;
        }

        .theme-toggle:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        .theme-toggle:hover {
            background: var(--bg-tool-hover);
            transform: scale(1.07);
        }

        .theme-toggle i {
            font-size: 1rem;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            scroll-behavior: smooth;
        }

        .message {
            display: flex;
            max-width: 85%;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.bot {
            align-self: flex-start;
        }

        .message-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 0.75rem;
            flex-shrink: 0;
            box-shadow: var(--shadow-md);
            border: 1.5px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message.user .message-avatar {
            background: var(--bg-message-user);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message.user .message-avatar i {
            color: var(--text-white);
            font-size: 1.25rem;
        }

        .message-content {
            background: var(--bg-message-bot);
            border: 1.5px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 0.85rem 1.1rem;
            position: relative;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .message.user .message-content {
            background: var(--bg-message-user);
            border: none;
            color: var(--text-user);
            border-bottom-right-radius: var(--radius-sm);
        }

        .message.bot .message-content {
            color: var(--text-bot);
            border-bottom-left-radius: var(--radius-sm);
        }

        .message-content:hover {
            box-shadow: var(--shadow-md);
        }

        .message-text {
            line-height: 1.6;
            word-wrap: break-word;
            font-size: 0.96rem;
        }

        .message-text p {
            margin-bottom: 0.75rem;
        }

        .message-text p:last-child {
            margin-bottom: 0;
        }

        .message-text ul, .message-text ol {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }

        .message-text li {
            margin-bottom: 0.5rem;
        }

        .message-text strong {
            font-weight: 600;
        }

        .message-text em {
            color: var(--accent-blue);
            font-style: italic;
        }

        .message-text code {
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.84rem;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .message-text pre {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: var(--radius-lg);
            overflow-x: auto;
            margin: 0.75rem 0;
            border: 1px solid var(--border-color);
            font-size: 0.88rem;
        }

        .message-text pre code {
            background: none;
            padding: 0;
            border: none;
            color: inherit;
        }

        .message-text blockquote {
            border-left: 4px solid var(--accent-blue);
            padding-left: 1rem;
            margin: 0.75rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        .message-text table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
            font-size: 0.84rem;
        }

        .message-text th,
        .message-text td {
            border: 1px solid var(--border-color);
            padding: 0.5rem;
            text-align: left;
        }

        .message-text th {
            background: var(--bg-tertiary);
            font-weight: 600;
        }

        .message-time {
            font-size: 0.78rem;
            color: var(--text-muted);
            margin-top: 0.7rem;
            text-align: right;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Welcome Message Special Layout */
        .welcome-message {
            max-width: 100%;
        }

        .welcome-content {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        .welcome-text {
            flex: 1;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: var(--bg-message-bot);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            border-bottom-left-radius: var(--radius-sm);
            animation: messageSlideIn 0.3s ease-out;
            box-shadow: var(--shadow-sm);
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite both;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Smooth transitions for all interactive elements */
        .tool-item,
        .tool-card,
        .project-header,
        .send-button,
        .theme-toggle,
        .mobile-menu-btn,
        .tools-expand-btn,
        .tools-modal-close {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Hover effects for better UX */
        .tool-item:hover,
        .tool-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.05) translateY(-1px);
        }

        .theme-toggle:hover,
        .mobile-menu-btn:hover {
            transform: scale(1.05);
        }

        /* Chat Input */
        .chat-input {
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border-top: 1.5px solid var(--border-color);
            position: relative;
            box-shadow: var(--shadow-md);
        }

        .input-container {
            display: flex;
            gap: 0.8rem;
            align-items: flex-end;
            max-width: 100%;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        #messageInput {
            width: 100%;
            min-height: 48px;
            max-height: 120px;
            padding: 0.75rem 1rem;
            background: var(--bg-input);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.5;
            resize: none;
            transition: var(--transition);
            font-family: inherit;
            box-shadow: var(--shadow-sm);
        }

        #messageInput:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.10), var(--shadow-sm);
        }

        #messageInput:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        #messageInput::placeholder {
            color: var(--text-muted);
        }

        .send-button {
            width: 48px;
            height: 48px;
            background: var(--bg-button);
            border: none;
            border-radius: 50%;
            color: var(--text-white);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .send-button:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.18), transparent);
            transition: left 0.5s;
        }

        .send-button:hover:not(:disabled)::before {
            left: 100%;
        }

        .send-button:hover:not(:disabled) {
            background: var(--bg-button-hover);
            transform: scale(1.07) translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .send-button:disabled::before {
            display: none;
        }

        /* Tools Expanded Modal */
        .tools-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-secondary);
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tools-modal.active {
            display: block;
            opacity: 1;
        }

        .tools-modal-content {
            background: var(--bg-secondary);
            border-radius: 0;
            box-shadow: none;
            width: 100%;
            height: 100%;
            max-width: none;
            max-height: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: none;
            transition: none;
        }

        .tools-modal.active .tools-modal-content {
            transform: none;
        }

        .tools-modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-header);
            color: var(--text-white);
        }

        .tools-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-white);
        }

        .tools-modal-close {
            display: none;
        }

        .tools-modal-body {
            padding: 0 2rem 2rem 2rem;
            overflow-y: auto;
        }
        .tools-modal-search {
            position: sticky;
            top: 0;
            z-index: 10;
            background: var(--bg-secondary);
        }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 0.5rem;
        }
        .tool-card {
            background: var(--bg-tool-item);
            border: 1.5px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 1.5rem 1.25rem 1.25rem 1.25rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            min-height: 180px;
        }
        .tool-card:hover {
            background: var(--bg-tool-hover);
            border-color: var(--accent-blue);
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }
        .tool-card-method {
            display: inline-block;
            padding: 0.25rem 0.85rem;
            border-radius: var(--radius-sm);
            font-size: 0.82rem;
            font-weight: 700;
            margin-bottom: 0.7rem;
            letter-spacing: 0.04em;
            box-shadow: 0 1px 4px 0 rgb(59 130 246 / 0.10);
        }
        .method-get { background-color: var(--method-get-bg); color: var(--method-get-text); }
        .method-post { background-color: var(--method-post-bg); color: var(--method-post-text); }
        .method-put { background-color: var(--method-put-bg); color: var(--method-put-text); }
        .method-delete { background-color: var(--method-delete-bg); color: var(--method-delete-text); }
        .method-patch { background-color: var(--method-patch-bg); color: var(--method-patch-text); }
        .method-head { background-color: var(--method-head-bg); color: var(--method-head-text); }
        .method-options { background-color: var(--method-options-bg); color: var(--method-options-text); }
        .tool-card-path {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            color: var(--accent-blue);
            margin-bottom: 0.7rem;
            word-break: break-all;
            background: var(--bg-tertiary);
            padding: 0.5rem 0.7rem;
            border-radius: var(--radius-sm);
        }
        .tool-card-name {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1.08rem;
        }
        .tool-card-description {
            font-size: 0.93rem;
            color: var(--text-secondary);
            margin-top: auto;
            line-height: 1.5;
        }
        @media (max-width: 600px) {
            .tools-modal-content {
                padding: 0.5rem;
            }
            .tools-modal-body {
                padding: 0 0.5rem 1rem 0.5rem;
            }
            .tools-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* Loading States */
        .loading-tools {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty state styling */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            text-align: center;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Better error states */
        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
            color: var(--accent-red);
            text-align: center;
        }

        .error-state i {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        /* Smooth scrolling for better UX */
        html {
            scroll-behavior: smooth;
            overflow: hidden;
            height: 100%;
        }

        /* Better text selection */
        ::selection {
            background: var(--accent-blue);
            color: var(--text-white);
        }

        ::-moz-selection {
            background: var(--accent-blue);
            color: var(--text-white);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-hover);
        }

        /* Esconde o botão de menu mobile por padrão */
        .mobile-menu-btn {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 340px;
            }
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                width: 270px;
            }
            .main-content {
                padding-left: 0;
            }
            .chat-header {
                padding: 1rem 1.5rem 1rem 1.5rem;
            }
            .chat-messages {
                padding: 1rem;
            }
        }
        @media (max-width: 768px) {
            .app-container {
                overflow-x: hidden;
            }
            
            .main-content {
                width: 100vw;
            }
            
            .sidebar-toggle {
                display: none;
            }
            
            .sidebar {
                position: fixed;
                left: -100%;
                z-index: 200;
                height: 100vh;
                box-shadow: var(--shadow-xl);
                width: 100%;
                border-right: none;
            }
            
            .sidebar.mobile-open {
                left: 0;
            }
            
            .sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 199;
                display: none;
                backdrop-filter: blur(5px);
            }
            
            .sidebar-overlay.active {
                display: block;
            }
            
            .mobile-menu-btn {
                position: fixed;
                top: 1rem;
                left: 1rem;
                width: 45px;
                height: 45px;
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-lg);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: var(--shadow-lg);
                z-index: 201;
                transition: var(--transition);
            }
            
            .mobile-menu-btn:hover {
                background: var(--bg-tool-hover);
                transform: scale(1.05);
            }
            
            .mobile-menu-btn i {
                color: var(--text-primary);
                font-size: 1.125rem;
            }
            
            .chat-header {
                padding: 0.8rem 1.2rem 0.8rem 1.2rem;
                min-height: 78px;
                justify-content: center;
            }

            .chat-title {
                position: absolute;
                left: 4.5rem;
                top: 50%;
                transform: translateY(-50%);
            }
            
            .chat-title h1 {
                font-size: 1.05rem;
            }
            
            .chat-status {
                display: none;
            }
            
            .theme-toggle {
                right: 0.7rem;
                top: 0.7rem;
                width: 38px;
                height: 38px;
            }
            
            .chat-messages {
                padding: 1rem;
                gap: 1rem;
            }
            
            .chat-input {
                padding: 0.75rem;
            }
            
            .input-container {
                gap: 0.5rem;
            }
            
            .message {
                max-width: 95%;
            }
            
            .welcome-robot {
                width: 120px;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .tools-modal {
                padding: 1rem;
            }

            .tools-modal-content {
                max-height: 90vh;
            }

            .tools-modal-header {
                padding: 1rem 1.5rem;
            }

            .tools-modal-body {
                padding: 1.5rem;
            }

            .tool-card {
                padding: 1.25rem;
            }
        }

        @media (max-width: 480px) {
            .chat-header {
                padding: 0.5rem 0.7rem;
                min-height: 65px;
            }

            .chat-title {
                left: 4rem;
            }
            
            .chat-header h1 {
                font-size: 0.9rem;
            }
            
            .chat-status {
                display: flex;
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
                position: absolute;
                right: 4rem;
                top: 50%;
                transform: translateY(-50%);
            }

            .chat-title {
                display: none;
            }
            
            .session-info {
                font-size: 0.7rem;
            }
            
            .session-id {
                font-size: 0.65rem;
                padding: 0.125rem 0.375rem;
            }
            
            .message-avatar {
                width: 32px;
                height: 32px;
                margin: 0 0.5rem;
            }
            
            .message-content {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
            }
            
            .welcome-robot {
                width: 100px;
            }
            
            .input-container {
                gap: 0.5rem;
            }
            
            .send-button {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .mobile-menu-btn {
                width: 40px;
                height: 40px;
                top: 0.75rem;
                left: 0.75rem;
            }

            .theme-toggle {
                width: 32px;
                height: 32px;
                top: 15px;
                right: 8px;
            }

            .tools-modal {
                padding: 0.5rem;
            }

            .tools-modal-header {
                padding: 0.75rem 1rem;
            }

            .tools-modal-body {
                padding: 1rem;
            }

            .tool-card {
                padding: 1rem;
            }

            .tool-card-name {
                font-size: 0.9rem;
            }

            .tool-card-path {
                font-size: 0.7rem;
                padding: 0.375rem;
            }
        }

        @media (max-width: 375px) {
             .chat-header h1 {
                font-size: 0.9rem;
            }

            .chat-status .session-info span {
                display: none;
            }
            
            .message {
                max-width: 99%;
            }
            
            .message-avatar {
                width: 16px;
                height: 16px;
                margin: 0 0.1rem;
            }
            
            .message-content {
                padding: 0.2rem 0.3rem;
                font-size: 0.78rem;
            }
            
            .welcome-robot {
                width: 80px;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        body.thinking .sidebar,
        body.thinking .mobile-menu-btn {
            opacity: 0.6;
            pointer-events: none;
            cursor: not-allowed;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for better accessibility */
        button:focus,
        input:focus,
        textarea:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <!-- Logo inicial -->
                    <img id="sidebarLogo" src="img/logotransparente.png" alt="Swagger Agent Logo">
                </div>
            </div>

            <div class="tools-panel">
                <div class="tools-header">
                    <div class="tools-title">
                        <span class="tools-icon">🛠️</span>
                        <span>Ferramentas</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <div class="tools-count" id="toolsCount">0</div>
                        <button class="tools-expand-btn" id="toolsExpandBtn" title="Expandir ferramentas">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="tools-content" id="toolsContent">
                    <div class="loading-tools">
                        <div class="loading-spinner"></div>
                        <p>Carregando ferramentas...</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Theme Toggle -->
            <button class="theme-toggle" id="themeToggle" title="Alternar tema">
                <i class="fas fa-moon"></i>
            </button>

            <!-- Chat Header -->
            <header class="chat-header">
                <div class="chat-title">
                    <h1>💬 Chat Inteligente</h1>
                </div>
                <div class="chat-status">
                    <div class="status-indicator"></div>
                    <div class="session-info">
                        Sessão: <span class="session-id" id="sessionId"></span>
                    </div>
                </div>
            </header>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be dynamically added here -->
            </div>

            <!-- Chat Input -->
            <div class="chat-input">
                <form class="input-container" id="chatForm">
                    <div class="input-wrapper">
                        <textarea
                            id="messageInput"
                            class="message-input"
                            placeholder="Escreva sua mensagem..."
                            rows="1"
                            data-min-rows="1"
                        ></textarea>
                    </div>
                    <button type="submit" class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </main>
    </div>

    <!-- Tools Expanded Modal -->
    <div class="tools-modal" id="toolsModal">
        <div class="tools-modal-content">
            <div class="tools-modal-header">
                <h2 class="tools-modal-title">🛠️ Todas as Ferramentas</h2>
                <button class="tools-modal-close" id="toolsModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tools-modal-search" style="padding: 0 2rem 1rem 2rem;">
                <input type="text" id="toolsSearchInput" placeholder="Pesquisar ferramentas..." style="width: 100%; padding: 0.7rem 1rem; border-radius: 0.5rem; border: 1.5px solid var(--border-color); font-size: 1rem; margin-top: 0.5rem;">
            </div>
            <div class="tools-modal-body">
                <div class="tools-grid" id="toolsGrid">
                    <!-- Tools will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const sessionId = Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        let currentTheme = localStorage.getItem('theme') || 'light';
        
        // DOM elements
        const elements = {
            chatMessages: document.getElementById('chatMessages'),
            messageInput: document.getElementById('messageInput'),
            chatForm: document.getElementById('chatForm'),
            sendButton: document.getElementById('sendButton'),
            sessionIdElement: document.getElementById('sessionId'),
            toolsContent: document.getElementById('toolsContent'),
            toolsCount: document.getElementById('toolsCount'),
            toolsGrid: document.getElementById('toolsGrid'),
            sidebar: document.getElementById('sidebar'),
            themeToggle: document.getElementById('themeToggle'),
            toolsExpandBtn: document.getElementById('toolsExpandBtn'),
            toolsModal: document.getElementById('toolsModal'),
            toolsModalClose: document.getElementById('toolsModalClose'),
            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            sidebarOverlay: document.getElementById('sidebarOverlay'),
            sidebarLogo: document.getElementById('sidebarLogo')
        };
        
        // API URLs
        const apiUrl = window.location.origin + '/api/chat';
        const toolsApiUrl = window.location.origin + '/api/tools';

        // Flag para verificar a primeira interação do usuário
        let firstInteraction = true;

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        function initializeApp() {
            // Set session ID
            elements.sessionIdElement.textContent = sessionId;
            
            // Apply saved theme
            applyTheme(currentTheme);
            
            // Load tools
            loadAvailableTools();
            
            // Add welcome message
            addWelcomeMessage();
            
            // Setup event listeners
            setupEventListeners();

            // Focar no campo de mensagem para permitir digitação imediata
            elements.messageInput.focus();
        }

        function setupEventListeners() {
            // Chat form submission
            elements.chatForm.addEventListener('submit', handleFormSubmit);
            
            // Message input auto-resize and keyboard shortcuts
            elements.messageInput.addEventListener('input', autoResizeTextarea);
            elements.messageInput.addEventListener('keydown', handleInputKeydown);
            
            // Theme toggle
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            // Tools expand button
            elements.toolsExpandBtn.addEventListener('click', openToolsModal);
            
            // Tools modal close
            elements.toolsModalClose.addEventListener('click', closeToolsModal);
            elements.toolsModal.addEventListener('click', (e) => {
                if (e.target === elements.toolsModal) {
                    closeToolsModal();
                }
            });
            
            // Mobile menu
            elements.mobileMenuBtn.addEventListener('click', toggleMobileSidebar);
            elements.sidebarOverlay.addEventListener('click', closeMobileSidebar);
            
            // Escape key to close modals
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeToolsModal();
                    closeMobileSidebar();
                }
            });
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            sendMessage();
        }

        function handleInputKeydown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function autoResizeTextarea() {
            const textarea = elements.messageInput;
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
            localStorage.setItem('theme', currentTheme);
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const icon = elements.themeToggle.querySelector('i');
            icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function toggleMobileSidebar() {
            elements.sidebar.classList.add('mobile-open');
            elements.sidebarOverlay.classList.add('active');
            elements.mobileMenuBtn.classList.add('hidden');
        }

        function closeMobileSidebar() {
            elements.sidebar.classList.remove('mobile-open');
            elements.sidebarOverlay.classList.remove('active');
            elements.mobileMenuBtn.classList.remove('hidden');
        }

        function openToolsModal() {
            elements.toolsModal.classList.add('active');
            const searchInput = document.getElementById('toolsSearchInput');
            if (searchInput) {
                searchInput.value = ''; // Limpa o campo de busca
            }
            
            // Se as ferramentas já foram carregadas, apenas re-renderiza para limpar o filtro
            // Senão, carrega as ferramentas
            if (allToolsData) {
                renderToolsGrid(allToolsData);
            } else {
                populateToolsModal();
            }
        }

        function closeToolsModal() {
            elements.toolsModal.classList.remove('active');
        }

        function loadAvailableTools() {
            // Show loading state
            elements.toolsContent.innerHTML = `
                <div class="loading-tools">
                    <div class="loading-spinner"></div>
                    <p>Carregando ferramentas...</p>
                </div>
            `;

            fetch(toolsApiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    displayTools(data);
                })
                .catch(error => {
                    console.error('Erro ao carregar ferramentas:', error);
                    elements.toolsContent.innerHTML = `
                        <div class="loading-tools">
                            <i class="fas fa-exclamation-triangle" style="color: var(--accent-orange); font-size: 2rem; margin-bottom: 1rem;"></i>
                            <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Erro ao carregar ferramentas</p>
                            <p style="font-size: 0.75rem; color: var(--text-muted);">Verifique sua conexão e recarregue a página</p>
                        </div>
                    `;
                });
        }

        function displayTools(data) {
            elements.toolsCount.textContent = data.totalTools;
            
            if (data.totalTools === 0) {
                elements.toolsContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>Nenhuma ferramenta disponível</p>
                        <p style="font-size: 0.75rem; margin-top: 0.5rem;">Verifique se há APIs configuradas</p>
                    </div>
                `;
                return;
            }

            let html = '';
            Object.entries(data.toolsByProject).forEach(([projectName, tools]) => {
                html += `
                    <div class="project-section">
                        <div class="project-header" onclick="toggleProject(this)" role="button" tabindex="0" onkeypress="if(event.key==='Enter')toggleProject(this)">
                            <i class="fas fa-chevron-down project-icon"></i>
                            <span class="project-name">${capitalize(projectName)}</span>
                            <span class="project-count">${tools.length}</span>
                        </div>
                        <div class="project-tools">
                `;
                
                tools.forEach(tool => {
                    const methodClass = `method-${tool.method.toLowerCase()}`;
                    html += `
                        <div class="tool-item" role="button" tabindex="0">
                            <div class="tool-name">${tool.description || tool.name}</div>
                            <div class="tool-method ${methodClass}">${tool.method}</div>
                            <div class="tool-path">${tool.baseUrl}${tool.path}</div>
                            <div class="tool-description">Nome: <em>${tool.name}</em></div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });

            elements.toolsContent.innerHTML = html;
            
            // Adicionar event listeners após renderizar o HTML
            const toolItems = elements.toolsContent.querySelectorAll('.tool-item');
            toolItems.forEach(item => {
                item.addEventListener('click', function() {
                    const toolName = this.querySelector('.tool-description em').textContent;
                    console.log('Clique detectado na ferramenta da sidebar:', toolName);
                    insertToolExample(toolName);
                });
                
                item.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const toolName = this.querySelector('.tool-description em').textContent;
                        console.log('Enter detectado na ferramenta da sidebar:', toolName);
                        insertToolExample(toolName);
                    }
                });
            });
        }

        // Busca/filtro de ferramentas no modal
        let allToolsData = null;
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('toolsSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    filterToolsModal(this.value);
                });
            }
        });

        function filterToolsModal(query) {
            if (!allToolsData) return;
            const lower = query.trim().toLowerCase();
            const filtered = { totalTools: 0, toolsByProject: {} };
            Object.entries(allToolsData.toolsByProject).forEach(([project, tools]) => {
                const filteredTools = tools.filter(tool =>
                    tool.name.toLowerCase().includes(lower) ||
                    (tool.description && tool.description.toLowerCase().includes(lower)) ||
                    tool.method.toLowerCase().includes(lower) ||
                    tool.path.toLowerCase().includes(lower)
                );
                if (filteredTools.length > 0) {
                    filtered.toolsByProject[project] = filteredTools;
                    filtered.totalTools += filteredTools.length;
                }
            });
            renderToolsGrid(filtered);
        }

        // Refatorar populateToolsModal para usar allToolsData e renderToolsGrid
        function populateToolsModal() {
            console.log('populateToolsModal iniciada');
            elements.toolsGrid.innerHTML = `
                <div class=\"loading-tools\">\n                    <div class=\"loading-spinner\"></div>\n                    <p>Carregando ferramentas...</p>\n                </div>\n            `;
            fetch(toolsApiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    allToolsData = data;
                    renderToolsGrid(data);
                })
                .catch(error => {
                    console.error('Erro ao carregar ferramentas no modal:', error);
                    elements.toolsGrid.innerHTML = `
                        <div class=\"error-state\">\n                            <i class=\"fas fa-exclamation-triangle\"></i>\n                            <p>Erro ao carregar ferramentas</p>\n                            <p style=\"font-size: 0.75rem; margin-top: 0.5rem;\">Tente novamente mais tarde</p>\n                        </div>\n                    `;
                });
        }

        function renderToolsGrid(data) {
            if (data.totalTools === 0) {
                elements.toolsGrid.innerHTML = `
                    <div class=\"empty-state\">\n                        <i class=\"fas fa-tools\"></i>\n                        <p>Nenhuma ferramenta encontrada</p>\n                        <p style=\"font-size: 0.75rem; margin-top: 0.5rem;\">Tente outro termo de busca</p>\n                    </div>\n                `;
                return;
            }
            let html = '';
            Object.entries(data.toolsByProject).forEach(([projectName, tools]) => {
                tools.forEach(tool => {
                    const methodClass = `method-${tool.method.toLowerCase()}`;
                    html += `
                        <div class=\"tool-card\" role=\"button\" tabindex=\"0\">\n                            <div class=\"tool-card-name\">${tool.description || tool.name}</div>\n                            <div class=\"tool-card-method ${methodClass}\">${tool.method}</div>\n                            <div class=\"tool-card-path\">${tool.baseUrl}${tool.path}</div>\n                            <div class=\"tool-card-description\">\n                                <strong>Nome da ferramenta:</strong> <em>${tool.name}</em>\n                            </div>\n                        </div>\n                    `;
                });
            });
            elements.toolsGrid.innerHTML = html;
            // Adicionar event listeners após renderizar o HTML
            const toolCards = elements.toolsGrid.querySelectorAll('.tool-card');
            toolCards.forEach(card => {
                card.addEventListener('click', function() {
                    const toolName = this.querySelector('.tool-card-description em').textContent;
                    selectToolFromModal(toolName);
                });
                card.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const toolName = this.querySelector('.tool-card-description em').textContent;
                        selectToolFromModal(toolName);
                    }
                });
            });
        }

        window.selectToolFromModal = function(toolName) {
            console.log('selectToolFromModal chamada com:', toolName);
            
            if (elements.sendButton.disabled) {
                console.warn("Uma mensagem já está sendo processada. Aguarde para clicar em uma nova ferramenta.");
                return;
            }
            
            const exampleText = `Como usar a ferramenta "${toolName}"?`;
            console.log('Texto de exemplo:', exampleText);
            
            elements.messageInput.value = exampleText;
            sendMessage();
            
            // Close mobile sidebar if open
            closeMobileSidebar();
            // Close tools modal if open
            closeToolsModal();
        };

        window.insertToolExample = function(toolName) {
            console.log('insertToolExample chamada com:', toolName);
            
            if (elements.sendButton.disabled) {
                console.warn("Uma mensagem já está sendo processada. Aguarde para clicar em uma nova ferramenta.");
                return;
            }
            
            const exampleText = `Como usar a ferramenta "${toolName}"?`;
            console.log('Texto de exemplo:', exampleText);
            
            elements.messageInput.value = exampleText;
            sendMessage();
            
            // Close mobile sidebar if open
            closeMobileSidebar();
            // Close tools modal if open
            closeToolsModal();
        };

        function capitalize(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        window.toggleProject = function(header) {
            header.classList.toggle('collapsed');
            const tools = header.nextElementSibling;
            tools.classList.toggle('collapsed');
        };

        function sendMessage() {
            const messageText = elements.messageInput.value.trim();
            if (!messageText) return;
            
            // Altera o logo após a primeira interação do usuário
            if (firstInteraction && elements.sidebarLogo) {
                elements.sidebarLogo.src = 'img/logo-transparente-ferramenta.png';
                firstInteraction = false;
            }

            addMessage(messageText, 'user');
            elements.messageInput.value = '';
            elements.messageInput.style.height = 'auto';
            
            // Disable input and button during processing
            document.body.classList.add('thinking');
            elements.sendButton.disabled = true;
            elements.messageInput.disabled = true;
            showTypingIndicator();
            
            sendMessageSync(messageText);
        }

        function sendMessageSync(messageText) {
            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    message: messageText,
                    sessionId: sessionId 
                })
            })
            .then(async response => {
                hideTypingIndicator();
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.content) {
                        addMessage(data.content, 'bot');
                    } else {
                        addMessage('Desculpe, recebi uma resposta inesperada do servidor.', 'bot');
                    }
                } else {
                    const errorText = await response.text();
                    console.error("Server error:", response.status, errorText);
                    addMessage('Desculpe, ocorreu um erro ao processar sua mensagem. Tente novamente.', 'bot');
                }
            })
            .catch(error => {
                hideTypingIndicator();
                console.error('Error:', error);
                addMessage('Erro de comunicação com o servidor. Verifique sua conexão e tente novamente.', 'bot');
            })
            .finally(() => {
                document.body.classList.remove('thinking');
                elements.sendButton.disabled = false;
                elements.messageInput.disabled = false;
                elements.messageInput.focus();
            });
        }

        function addMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;

            // Create avatar
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            
            if (type === 'bot') {
                const avatarImg = document.createElement('img');
                avatarImg.src = 'img/icone.png';
                avatarImg.alt = 'Bot Avatar';
                avatarImg.onerror = function() {
                    // Fallback to icon if image fails to load
                    this.style.display = 'none';
                    const icon = document.createElement('i');
                    icon.className = 'fas fa-robot';
                    icon.style.color = 'var(--text-white)';
                    icon.style.fontSize = '1.25rem';
                    avatarDiv.appendChild(icon);
                };
                avatarDiv.appendChild(avatarImg);
            } else {
                const userIcon = document.createElement('i');
                userIcon.className = 'fas fa-user';
                avatarDiv.appendChild(userIcon);
            }

            // Create message content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';

            if (type === 'bot') {
                // Use marked.js for markdown rendering
                textDiv.innerHTML = marked.parse(text);
                
                // Add syntax highlighting for code blocks
                const codeBlocks = textDiv.querySelectorAll('pre code');
                codeBlocks.forEach(block => {
                    block.style.background = 'var(--bg-tertiary)';
                    block.style.padding = '0.5rem';
                    block.style.borderRadius = 'var(--radius-sm)';
                    block.style.display = 'block';
                    block.style.overflowX = 'auto';
                });
            } else {
                textDiv.textContent = text;
            }

            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = new Date().toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            contentDiv.appendChild(textDiv);
            contentDiv.appendChild(timeDiv);

            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            elements.chatMessages.appendChild(messageDiv);
            
            // Smooth scroll to bottom
            setTimeout(() => {
                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            }, 100);
        }

        function addWelcomeMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot welcome-message';

            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            const avatarImg = document.createElement('img');
            avatarImg.src = 'img/icone.png';
            avatarImg.alt = 'Bot Avatar';
            avatarImg.onerror = function() {
                this.style.display = 'none';
                const icon = document.createElement('i');
                icon.className = 'fas fa-robot';
                icon.style.color = 'var(--text-white)';
                icon.style.fontSize = '1.25rem';
                avatarDiv.appendChild(icon);
            };
            avatarDiv.appendChild(avatarImg);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            const welcomeText = document.createElement('div');
            welcomeText.className = 'message-text';
            welcomeText.innerHTML = marked.parse(`👋 **Bem-vindo(a) ao Swagger Agent!**

🤖 Sou seu assistente inteligente, especializado em interagir com **APIs externas** através de uma conversa natural.

❓ **Como posso ajudar você hoje?**  
Basta descrever sua necessidade em linguagem natural, e eu:
* Identificarei a ferramenta mais adequada
* Executarei a operação desejada
* Retornarei os resultados de forma clara

💡 **Exemplos de solicitações:**
* _"Quais produtos estão disponíveis na loja?"_
* _"Crie um novo usuário com nome João Silva"_
* _"Busque informações do cliente com ID 12345"_

🛠️ **Explore as Ferramentas**  
No painel à esquerda, você encontra todas as APIs disponíveis. Clique em qualquer uma delas para ver exemplos de uso.`);

            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = new Date().toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            contentDiv.appendChild(welcomeText);
            contentDiv.appendChild(timeDiv);

            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            
            elements.chatMessages.appendChild(messageDiv);
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'typing-indicator';
            indicator.className = 'message bot';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar';
            const avatarImg = document.createElement('img');
            avatarImg.src = 'img/icone.png';
            avatarImg.alt = 'Bot Avatar';
            avatarDiv.appendChild(avatarImg);
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            indicator.appendChild(avatarDiv);
            indicator.appendChild(typingDiv);
            elements.chatMessages.appendChild(indicator);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }
    </script>
</body>
</html>

